<% if (typeof video != 'undefined') { %>
	<div class="comments">
		<h2>Comments:</h2>
		<p>Sort Comments:</p>
		<select id="commentSort" onchange="sortComments(this);">
			<option value="top" selected>Top</option>
			<option value="bottom">Bottom</option>
			<option value="oldest">Oldest</option>
			<option value="newest">Newest</option>
		</select>
		<div id="commentform">
			<% var commentlink = `/comment/${video.id}`; %>
			<form action="<%= commentlink %>" method="post" enctype='multipart/form-data'>
				<textarea id="commenttext" name="commenttext" placeholder="Comment Something" maxlength="1000" rows="10" cols="50"></textarea><br><br>

				<label for="reactionfile">Reaction Image/Video:</label><br>
				<input type="file" id="reactionfile" name="reactionfile" accept="image/*,video/*"><br><br>

				<button id="commentbtn" type="submit" value="Submit">Post Comment</button>
			</form>
		</div>
		<div id="theComments">
			<% if (typeof comments != 'undefined') { %>
				<% comments.forEach((item, index) => { %>
					<% if (!item.parent_id) { %>
						<hr>
						<div class="comment" id="<%= item.id %>" likes="<%= item.likes %>" dislikes="<%= item.dislikes %>" posttime="<%= item.posttime %>">
							<h3>&nbsp<%= item.username %></h3>
							<p>&nbsp;&nbsp<%= item.comment %></p>
							<div class="commentlikes" id="<%= item.id %>">
								&nbsp
								<button id="commentLike" onclick="likeComment('<%= item.id %>')"><img src="/content/icons/like.ico"></button>
								<p id="<%= item.id %>likes"><%= item.likes %></p>
								<button id="commentDislike" onclick="dislikeComment('<%= item.id %>')"><img src="/content/icons/dislike.ico"></button>
								<p id="<%= item.id %>dislikes"><%= item.dislikes %></p>
								<button id="replybtn" onclick="showbox('<%= item.id %>replybox')">Reply</button>
								<button id="showreplies" onclick="showbox('<%= item.id %>replies')">Replies</button>
							</div>
							<div class="replybox" id="<%= item.id %>replybox">
								<% var replylink = commentlink + `?parent_id=${item.id}`; %>
								<form action="<%= replylink %>" method="post">
									<textarea id="commenttext" name="commenttext" placeholder="Comment Something" maxlength="1000" rows="10" cols="50"></textarea><br>
									<button id="commentbtn" type="submit" value="Submit">Post Comment</button>
									<input type="hidden" id="base_parent_id" name="base_parent_id" value="<%= item.id %>">
									<input type="button" onclick="showbox('<%= item.id %>replybox')" value="Cancel">
								</form>
							</div>
							<div class="replies" id="<%= item.id %>replies">
								<% var replies = comments.filter((obj) => obj.base_parent_id == item.id); %>
								<% var base_parent_id = item.id; %>
								<% replies.forEach((item, index) => { %>
									<svg height="20" width="500">
										<% for (var i=1; i < parseInt(item.depth_level) + 1; i++) { %>
											<circle cx="<%= i*20 %>" cy="10" r="5" fill="#adff12"/>
										<% } %>
									</svg>
									<h3>&nbsp;&nbsp<%= item.username %></h3>
									<p>&nbsp;&nbsp;&nbsp<%= item.comment %></p>
									<div class="commentlikes" id="<%= item.id %>">
										&nbsp;&nbsp
										<button id="commentLike" onclick="likeComment('<%= item.id %>')"><img src="/content/icons/like.ico"></button>
										<p id="<%= item.id %>likes"><%= item.likes %></p>
										<button id="commentDislike" onclick="dislikeComment('<%= item.id %>')"><img src="/content/icons/dislike.ico"></button>
										<p id="<%= item.id %>dislikes"><%= item.dislikes %></p>
										<button id="replybtn" onclick="showbox('<%= item.id %>replybox')">Reply</button>
									</div>
									<div class="replybox" id="<%= item.id %>replybox">
										<% var replylink = commentlink + `?parent_id=${item.id}`; %>
										<form action="<%= replylink %>" method="post">
											<textarea id="commenttext" name="commenttext" placeholder="Comment Something" maxlength="1000" rows="10" cols="50"></textarea><br>
											<button id="commentbtn" type="submit" value="Submit">Post Comment</button>
											<input type="hidden" id="base_parent_id" name="base_parent_id" value="<%= base_parent_id %>">
											<input type="button" onclick="showbox('<%= item.id %>replybox')" value="Cancel">
										</form>
									</div>
								<% }); %>
							</div>
						</div>
						<hr>
					<% } %>
				<% }); %>
			<% } %>
		</div>
	</div>
<% } %>
