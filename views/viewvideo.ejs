<!DOCTYPE html>
<html>
	<head>
		<%- include('content/html/head.html') %>
		<title><%= video.title %> - Crumb</title>
	</head>
	<body>
		<%- include('content/html/banner.html') %>

		<%- include('content/html/body.html') %>

		<div class="container">
			<div class="video-contents">
				<div class="video-container">
					<div id="loading"></div>
					<video poster="<%= video.thumbnail %>" id="video">
						<source src="http://localhost/video/<%= video.id %>" type="video/mp4">
						<source src="http://localhost/video/<%= video.id %>" type="video/webm">
						<source src="http://localhost/video/<%= video.id %>" type="video/ogg">
						<h1>HTML Video is not supported in your browser, sorry.</h1>
					</video>
					<div class="fullscreen-text">
						<h1 id="TitleFullscreen"><%= video.title %></h1>
					</div>
					<div class="video-controls">
						<button id="playBtn"><img src="/content/icons/play.ico"></button>
						<input id="seeker" type="range" min="0" max="100" value="0" step="1" oninput="vidSeek()">
						<p id="videotime"></p>
						<button id="muteBtn"><img src="/content/icons/sound.ico"></button>
						<input id="volumeslider" type="range" min="0" max="100" step="1" oninput="changeVolume()">
						<button id="fullscreenBtn"><img src="/content/icons/fullscreen.ico"></button>
					</div>
				</div>

				<div class="videotext">
					<h1 id="title"><%= video.title %></h1>
					<% if (typeof video.topics != 'object') { %>
						<hr>
						<p>
						<% var topicsarray = video.topics.split(","); %>
						<% topicsarray.forEach((item, index) => { %>
							<%= item %> 
						<% }); %>
						</p>
					<% } %>
					<hr>
					<div class="extralinks" id="<%= video.id %>extralinks">
						<button onclick='showform(&quot;<%= video.id %>&quot;, &quot;playlistform&quot;)'>Add To Playlist</button>
						<button onclick='showform(&quot;<%= video.id %>&quot;, &quot;reportform&quot;)'>Report</button>
					</div>
					<div class="extralinkforms" id="<%= video.id %>extralinkforms">
						<object id="<%= video.id %>playlistform">
							<h3><a href="/playlist/new/?videoid=<%= video.id %>">Create Playlist</a></h3><br>
							<% if (typeof playlists != 'undefined') { %>
								<% playlists.forEach((plist, index) => { %>
									<h3><a href="/playlistvideo/add/<%= plist.id %>/<%= item.id %>"><%= plist.name %></a></h3><br>
								<% }); %>
							<% } %>
						</object>
						<object id="<%= video.id %>reportform">
							<form action="/report/<%= video.id %>" method="post">
								<%- include('content/ejs/reportform.ejs') %>
							</form>
						</object>
					</div>
					<hr>
					<div class="channel-details">
						<% var channellink = `/u/${videocreator.id}` %>
						<div id="icon">
							<a href="<%= channellink %>">
								<img src="<%= videocreator.channelicon %>">
							</a>
						</div>
						<div id="channel-text">	
							<a href="<%= channellink %>">
								<h2><%= videocreator.username %></h2>
							</a>
						</div>
						<div class="video-buttons">
							<div class="subscribe-section">
								<% if (typeof subscribed != 'undefined') { %>
									<% if (subscribed != 0) { %>
										<button id="subscribebutton" onclick='subscribe(&quot;<%= videocreator.id %>&quot;)'>Subscribed</button>
									<% } else { %>
										<button id="subscribebutton" onclick='subscribe(&quot;<%= videocreator.id %>&quot;)'>Subscribe</button>
									<% } %>
								<% } else { %>
									<button id="subscribebutton" onclick='subscribe(&quot;<%= videocreator.id %>&quot;)'>Subscribe</button>
								<% } %>
								<p><%= videocreator.subscribers %></p>
							</div>
							<div class="likesection">
								<button class="likebuttons" onclick="likeVideo()"><img src="/content/icons/like.ico"></button>
								<p id="likes"><%= video.likes %></p>
								<button class="likebuttons" onclick="dislikeVideo()"><img src="/content/icons/dislike.ico"></button>
								<p id="dislikes"><%= video.dislikes %></p>
							</div>
						</div>
					</div>
					<hr>
					<% var datestring = video.posttime.split("-"); %>
					<p><%= approx(video.views) %> Views | Posted: <%= datestring[1] + "-" + datestring[2] + "-" + datestring[0] %></p>
					<hr>
					<div class="description">
						<% if (video.description.length > 100) { %>
							<p>
								<%= video.description.substr(0, 100) %>
								<span id="dots">...</span>
							</p>
							<% var moretext = video.description.substr(100); %>
							<div id="more" style="display: none">
								<p><%= moretext %></p>
							</div>
							<button onclick="readMore()" id="readMoreBtn">Read More</button>
						<% } else { %>
							<p><%= video.description %></p>
						<% } %>
					</div>
					<hr>
				</div>

				<% if (typeof user != 'undefined') { %>
					<% if (video.user_id == user.id) { %>
						<% var deletelink = `/v/delete/${video.id}` %>
						<button><a href="<%= deletelink %>">Delete Video</a></button>
						<hr>
					<% } %>
				<% } %>

				<div class="comments">
					<h2>Comments:</h2>
					<p>Sort Comments:</p>
					<select id="commentSort" onchange="sortComments(this);">
						<option value="top" selected>Top</option>
						<option value="bottom">Bottom</option>
						<option value="oldest">Oldest</option>
						<option value="newest">Newest</option>
					</select>
					<div id="commentform">
						<% var commentlink = `/comment/${video.id}`; %>
						<form action="<%= commentlink %>" method="post">
							<textarea id="commenttext" name="commenttext" placeholder="Comment Something" maxlength="1000" rows="10" cols="50"></textarea><br>
							<button id="commentbtn" type="submit" value="Submit">Post Comment</button>
						</form>
					</div>
					<div id="theComments">
						<% if (typeof comments != 'undefined') { %>
							<% comments.forEach((item, index) => { %>
								<% if (!item.parent_id) { %>
									<hr>
									<div class="comment" id="<%= item.id %>" likes="<%= item.likes %>" dislikes="<%= item.dislikes %>" posttime="<%= item.posttime %>">
										<h3>&nbsp<%= item.username %></h3>
										<p>&nbsp;&nbsp<%= item.comment %></p>
										<div class="commentlikes" id="<%= item.id %>">
											&nbsp
											<button id="commentLike" onclick="likeComment('<%= item.id %>')"><img src="/content/icons/like.ico"></button>
											<p id="<%= item.id %>likes"><%= item.likes %></p>
											<button id="commentDislike" onclick="dislikeComment('<%= item.id %>')"><img src="/content/icons/dislike.ico"></button>
											<p id="<%= item.id %>dislikes"><%= item.dislikes %></p>
											<button id="replybtn" onclick='showbox(&quot;<%= item.id %>replybox&quot;)'>Reply</button>
											<button id="showreplies" onclick='showbox(&quot;<%= item.id %>replies&quot;)'>Replies</button>
										</div>
										<div class="replybox" id="<%= item.id %>replybox">
											<% var replylink = commentlink + `?parent_id=${item.id}`; %>
											<form action="<%= replylink %>" method="post">
												<textarea id="commenttext" name="commenttext" placeholder="Comment Something" maxlength="1000" rows="10" cols="50"></textarea><br>
												<button id="commentbtn" type="submit" value="Submit">Post Comment</button>
												<input type="button" onclick='showbox(&quot;<%= item.id %>replybox&quot;)' value="Cancel">
											</form>
										</div>
										<div class="replies" id="<%= item.id %>replies">
											<% var replies = comments.filter((obj) => obj.parent_id == item.id); %>
											<% replies.forEach((item, index) => { %>
												<h3>&nbsp;&nbsp<%= item.username %></h3>
												<p>&nbsp;&nbsp;&nbsp<%= item.comment %></p>
												<div class="commentlikes" id="<%= item.id %>">
													&nbsp;&nbsp
													<button id="commentLike" onclick="likeComment('<%= item.id %>')"><img src="/content/icons/like.ico"></button>
													<p id="<%= item.id %>likes"><%= item.likes %></p>
													<button id="commentDislike" onclick="dislikeComment('<%= item.id %>')"><img src="/content/icons/dislike.ico"></button>
													<p id="<%= item.id %>dislikes"><%= item.dislikes %></p>
												</div>
											<% }); %>
										</div>
									</div>
									<hr>
								<% } %>
							<% }); %>
						<% } %>
					</div>
				</div>

				<div id="chatReplay">
					<% if (typeof chatReplayMessages != 'undefined') { %>
						<h3>Chat Replay:</h3>
					<% } %>
				</div>
			</div>
			<div class="reccomendations">
				<h2>&nbspUp Next</h2>
				<% if (typeof videos != 'undefined') { %>
					<% videos.forEach((item, index) => { %>
						<div class="links">
							<div class="text">
								<a href="/v/<%= item.id %>">
									<img src="<%= item.thumbnail %>" width="600px" height="500px">
								</a>
								<a href="/v/<%= item.id %>">
									<h2><strong>&nbsp;&nbsp<%= item.title %></strong></h2>
								</a>
								<p>&nbsp;&nbsp<%= item.description.substr(0, 14) %>...</p>
							</div>
							<svg width="10" height="40" class="extras" onclick='showlinks(&quot;<%= item.id %>extralinks&quot;, &quot;<%= item.id %>&quot;)'>
								<circle cx="5" cy="5" r="5" fill="#adff12"/>
								<circle cx="5" cy="20" r="5" fill="#adff12"/>
								<circle cx="5" cy="35" r="5" fill="#adff12"/>
							</svg>
							<div id="<%= item.id %>extralinks" class="extralinks">
								<button onclick='showform(&quot;<%= item.id %>&quot;, &quot;playlistform&quot;)'>Add To Playlist</button>
								<button>Not Interested</button>
								<button onclick='showform(&quot;<%= item.id %>&quot;, &quot;reportform&quot;)'>Report</button>
							</div>
							<div class="extralinkforms" id="<%= item.id %>extralinkforms">
								<object id="<%= item.id %>playlistform">
									<h3><a href="/playlist/new/?videoid=<%= item.id %>">Create Playlist</a></h3><br>
									<% if (typeof playlists != 'undefined') { %>
										<% playlists.forEach((plist, index) => { %>
											<h3><a href="/playlistvideo/add/<%= plist.id %>/<%= item.id %>"><%= plist.name %></a></h3><br>
										<% }); %>
									<% } %>
								</object>
								<object id="<%= item.id %>reportform">
									<form action="/report/<%= item.id %>" method="post">
										<%- include('content/ejs/reportform.ejs') %>
									</form>
								</object>
							</div>
						</div>
					<% }); %>
				<% } %>
			</div>
		</div>

		<script type="text/javascript">
			function readMore() {
				var dots = document.getElementById("dots");
				var moreText = document.getElementById("more");
				var btnText = document.getElementById("readMoreBtn");

				if (dots.style.display === "none") {
					dots.style.display = "inline";
					btnText.innerHTML = "Read More";
					moreText.style.display = "none";
				} else {
					dots.style.display = "none";
					btnText.innerHTML = "Read Less";
					moreText.style.display = "inline";
				}
			}
		</script>

		<script type="text/javascript">
			var videoelement = document.getElementById("video");
			var videovar = <%- JSON.stringify(video) %>;
			var chatreplayelement = document.getElementById("chatReplay");
			<% if (typeof videos[0] != 'undefined') { %>
				var nextvideo = <%- JSON.stringify(videos[0]) %>;
			<% } %>
			<% if (typeof commentid != 'undefined') { %>
				var commentid = <%- JSON.stringify(commentid) %>;
				var commentElement = document.getElementById(commentid);
				commentElement.scrollIntoView();
				commentElement.style.backgroundColor = "#1a1a1a";
				commentElement.style.borderStyle = "solid";
				commentElement.style.borderWidth = "5px";
				commentElement.style.borderColor = "#adff12";
			<% } %>
			<% if (typeof chatReplayMessages != 'undefined') { %>
				var chatReplayMessages = <%- JSON.stringify(chatReplayMessages) %>;
			<% } %>
		</script>

		<script src="/content/javascript/videocontroller.js"></script>
		<script src="/content/javascript/likedislike.js"></script>
		<script src="/content/javascript/subscribe.js"></script>
		<script src="/content/javascript/elementclicks.js"></script>
		<script src="/content/javascript/chatreplay.js"></script>
		<script src="/content/javascript/sortcomments.js"></script>
	</body>
</html>
