<!DOCTYPE html>
<html>
	<head>
		<%- include('content/html/head.html') %>
		<title><%= video.title %> - Crumb</title>
	</head>
	<body>
		<%- include('content/html/banner.html') %>

		<%- include('content/html/body.html') %>

		<div class="container">
			<div class="video-contents">
				<div class="video-container">
					<div id="loading"></div>
					<video poster="<%= video.thumbnail %>" id="video">
						<source src="<%= video.video %>" type="video/mp4">
						<source src="<%= video.video %>" type="video/ogg">
						<source src="<%= video.video %>" type="video/webm">
						<h1>YOUR BROWSER DOES NOT SUPPORT HTML VIDEOS</h1>
					</video>
					<div class="fullscreen-text">
						<h1 id="TitleFullscreen"><%= video.title %></h1>
					</div>
					<div class="video-controls">
						<button id="playBtn"><img src="/icons/play.ico"></button>
						<input id="seeker" type="range" min="0" max="100" value="0" step="1" oninput="vidSeek()">
						<p id="videotime"></p>
						<button id="muteBtn"><img src="/icons/sound.ico"></button>
						<input id="volumeslider" type="range" min="0" max="100" step="1" oninput="changeVolume()">
						<button id="fullscreenBtn"><img src="/icons/fullscreen.ico"></button>
					</div>
				</div>

				<div class="videotext">
					<h1 id="title"><%= video.title %></h1>
					<% if (typeof video.topics != 'object') { %>
						<hr>
						<p>
						<% var topicsarray = video.topics.split(","); %>
						<% topicsarray.forEach((item, index) => { %>
							<%= item %> 
						<% }); %>
						</p>
					<% } %>
					<hr>
					<div class="channel-details">
						<% var channellink = `/u/${videocreator.id}` %>
						<div id="icon">
							<a href="<%= channellink %>">
								<img src="<%= videocreator.channelicon %>">
							</a>
						</div>
						<div id="channel-text">	
							<a href="<%= channellink %>">
								<h2><%= videocreator.username %></h2>
							</a>
						</div>
						<div class="video-buttons">
							<div class="subscribe-section">
								<% if (typeof subscribed != 'undefined') { %>
									<% if (subscribed != 0) { %>
										<button id="subscribebutton" onclick='subscribe(&quot;<%= videocreator.id %>&quot;)'>Subscribed</button>
									<% } else { %>
										<button id="subscribebutton" onclick='subscribe(&quot;<%= videocreator.id %>&quot;)'>Subscribe</button>
									<% } %>
								<% } else { %>
									<button id="subscribebutton" onclick='subscribe(&quot;<%= videocreator.id %>&quot;)'>Subscribe</button>
								<% } %>
								<p><%= videocreator.subscribers %></p>
							</div>
							<div class="likesection">
								<button class="likebuttons" onclick="likeVideo()"><img src="/icons/like.ico"></button>
								<p id="likes"><%= video.likes %></p>
								<button class="likebuttons" onclick="dislikeVideo()"><img src="/icons/dislike.ico"></button>
								<p id="dislikes"><%= video.dislikes %></p>
							</div>
						</div>
					</div>
					<hr>
					<% var datestring = video.posttime.split("-"); %>
					<p><%= approx(video.views) %> Views | Posted: <%= datestring[1] + "-" + datestring[2] + "-" + datestring[0] %></p>
					<hr>
					<div class="description">
						<% if (video.description.length > 100) { %>
							<p>
								<%= video.description.substr(0, 100) %>
								<span id="dots">...</span>
							</p>
							<% var moretext = video.description.substr(100); %>
							<div id="more" style="display: none">
								<p><%= moretext %></p>
							</div>
							<button onclick="readMore()" id="readMoreBtn">Read More</button>
						<% } else { %>
							<p><%= video.description %></p>
						<% } %>
					</div>
					<hr>
				</div>

				<% if (typeof user != 'undefined') { %>
					<% if (video.user_id == user.id) { %>
						<% var deletelink = `/v/delete/${video.id}` %>
						<button><a href="<%= deletelink %>">Delete Video</a></button>
						<hr>
					<% } %>
				<% } %>

				<div class="comments">
					<h2>Comments:</h2>
					<div id="commentform">
						<% var commentlink = `/comment/${video.id}`; %>
						<form action="<%= commentlink %>" method="post">
							<textarea id="commenttext" name="commenttext" placeholder="Comment Something" maxlength="1000" rows="10" cols="50"></textarea><br>
							<button id="commentbtn" type="submit" value="Submit">Post Comment</button>
						</form>
					</div>
					<div id="theComments">
						<% if (typeof comments != 'undefined') { %>
							<% comments.forEach((item, index) => { %>
								<% if (!item.parent_id) { %>
									<hr>
									<div id="<%= item.id %>">
										<h3>&nbsp<%= item.username %></h3>
										<p>&nbsp;&nbsp<%= item.comment %></p>
										<div class="commentlikes" id="<%= item.id %>">
											&nbsp
											<button id="commentLike" onclick="likeComment('<%= item.id %>')"><img src="/icons/like.ico"></button>
											<p id="<%= item.id %>likes"><%= item.likes %></p>
											<button id="commentDislike" onclick="dislikeComment('<%= item.id %>')"><img src="/icons/dislike.ico"></button>
											<p id="<%= item.id %>dislikes"><%= item.dislikes %></p>
											<button id="replybtn" onclick='showbox(&quot;<%= item.id %>replybox&quot;)'>Reply</button>
											<button id="showreplies" onclick='showbox(&quot;replies&quot;)'>Replies</button>
										</div>
										<div class="replybox" id="<%= item.id %>replybox">
											<% var replylink = commentlink + `?parent_id=${item.id}`; %>
											<form action="<%= replylink %>" method="post">
												<textarea id="commenttext" name="commenttext" placeholder="Comment Something" maxlength="1000" rows="10" cols="50"></textarea><br>
												<button id="commentbtn" type="submit" value="Submit">Post Comment</button>
												<input type="button" onclick='showbox(&quot;<%= item.id %>replybox&quot;)' value="Cancel">
											</form>
										</div>
										<div class="replies" id="replies">
											<% var replies = comments.filter((obj) => obj.parent_id == item.id); %>
											<% replies.forEach((item, index) => { %>
												<h3>&nbsp;&nbsp<%= item.username %></h3>
												<p>&nbsp;&nbsp;&nbsp<%= item.comment %></p>
												<div class="commentlikes" id="<%= item.id %>">
													&nbsp;&nbsp
													<button id="commentLike" onclick="likeComment('<%= item.id %>')"><img src="/icons/like.ico"></button>
													<p id="<%= item.id %>likes"><%= item.likes %></p>
													<button id="commentDislike" onclick="dislikeComment('<%= item.id %>')"><img src="/icons/dislike.ico"></button>
													<p id="<%= item.id %>dislikes"><%= item.dislikes %></p>
												</div>
											<% }); %>
										</div>
									</div>
									<hr>
								<% } %>
							<% }); %>
						<% } %>
					</div>
				</div>
			</div>
			<div class="reccomendations">
				<h2>&nbspUp Next</h2>
				<% if (typeof videos != 'undefined') { %>
					<% for (var i=0; i < videos.length; i++) { %>
						<div class="links">
							<div class="text">
								<a href="/v/<%= videos[i].id %>">
									<img src="<%= videos[i].thumbnail %>" width="600px" height="500px">
								</a>
								<a href="/v/<%= videos[i].id %>">
									<h2><strong>&nbsp;&nbsp<%= videos[i].title %></strong></h2>
								</a>
								<p>&nbsp;&nbsp<%= videos[i].description.substr(0, 14) %>...</p>
							</div>
							<svg width="10" height="40" class="extras" onclick='showboxVertical(&quot;<%= videos[i].id %>extraslinks&quot;)'>
								<circle cx="5" cy="5" r="5" fill="#adff12"/>
								<circle cx="5" cy="20" r="5" fill="#adff12"/>
								<circle cx="5" cy="35" r="5" fill="#adff12"/>
							</svg>
							<div id="<%= videos[i].id %>extraslinks" class="extralinks">
								<a>Add To Playlist</a>
								<a>Not Interested</a>
								<a>Report</a>
							</div>
						</div>
					<% } %>
				<% } %>
			</div>
		</div>

		<script type="text/javascript">
			function readMore() {
				var dots = document.getElementById("dots");
				var moreText = document.getElementById("more");
				var btnText = document.getElementById("readMoreBtn");

				if (dots.style.display === "none") {
					dots.style.display = "inline";
					btnText.innerHTML = "Read More";
					moreText.style.display = "none";
				} else {
					dots.style.display = "none";
					btnText.innerHTML = "Read Less";
					moreText.style.display = "inline";
				}
			}
		</script>

		<script type="text/javascript">
			var videovar = <%- JSON.stringify(video) %>;
			<% if (typeof videos[0] != 'undefined') { %>
				var nextvideo = <%- JSON.stringify(videos[0]) %>;
			<% } %>
			<% if (typeof commentid != 'undefined') { %>
				var commentid = <%- JSON.stringify(commentid) %>;
				var commentElement = document.getElementById(commentid);
				commentElement.scrollIntoView();
				commentElement.style.backgroundColor = "#1a1a1a";
				commentElement.style.borderStyle = "solid";
				commentElement.style.borderWidth = "5px";
				commentElement.style.borderColor = "#adff12";
			<% } %>
		</script>

		<script src="/javascript/videocontroller.js"></script>
		<script src="/javascript/likedislike.js"></script>
		<script src="/javascript/subscribe.js"></script>
		<script src="/javascript/elementclicks.js"></script>
	</body>
</html>
