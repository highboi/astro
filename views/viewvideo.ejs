<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="/main.css">
		<title><%= video.title %></title>
	</head>
	<body>
		<object data="/banner.html" class="bannerObj"></object>

		<div class="messages">
			<% if (typeof message != 'undefined') { %>
				<p><%= message %></p>
			<% } %>

			<ul>
				<% if (typeof errors != 'undefined') { %>
					<% errors.forEach((item, index) => { %>
						<li><%= item.message %></li>
					<% }); %>
				<% } %>
			</ul>
		</div>

		<div class="container">
			<div class="video-contents">
				<div class="video-container">
					<video poster="<%= video.thumbnail %>" id="video">
						<source src="<%= video.video %>" type="video/mp4">
						<source src="<%= video.video %>" type="video/ogg">
						<source src="<%= video.video %>" type="video/webm">
						<h1>YOUR BROWSER DOES NOT SUPPORT HTML VIDEOS</h1>
					</video>
					<div class="video-controls">
						<button id="playBtn"><img src="/play.ico"></button>
						<input id="seeker" type="range" min="0" max="100" value="0" step="1" oninput="vidSeek()">
						<p id="videotime"></p>
						<button id="muteBtn"><img src="/sound.ico"></button>
						<input id="volumeslider" type="range" min="0" max="100" step="1" oninput="changeVolume()">
						<button id="fullscreenBtn"><img src="/fullscreen.ico"></button>
					</div>
				</div>

				<div class="videotext">
					<h1 id="title"><%= video.title %></h1>
					<hr>
					<div class="channel-details">
						<% var channellink = `/u/${videocreator.id}` %>
						<div id="icon">
							<a href="<%= channellink %>">
								<img src="<%= videocreator.channelicon %>">
							</a>
						</div>
						<div id="channel-text">	
							<a href="<%= channellink %>">
								<h2><%= videocreator.username %></h2>
							</a>
						</div>
						<div class="video-buttons">
							<button id="subscribebutton" onclick="subscribe();">Subscribe</button>
							<div class="likesection">
								<button class="likebuttons" onclick="likeVideo()"><img src="/like.ico"></button>
								<p id="likes"><%= video.likes %></p>
								<button class="likebuttons" onclick="dislikeVideo()"><img src="/dislike.ico"></button>
								<p id="dislikes"><%= video.dislikes %></p>
							</div>
						</div>
					</div>
					<hr>
					<p><%= approx(video.views) %> Views</p>
					<hr>
					<div class="description">
						<% if (video.description.length > 100) { %>
							<p>
								<%= video.description.substr(0, 100) %>
								<span id="dots">...</span>
							</p>
							<% var moretext = video.description.substr(100); %>
							<div id="more" style="display: none">
								<p><%= moretext %></p>
							</div>
							<button onclick="readMore()" id="readMoreBtn">Read More</button>
						<% } else { %>
							<p><%= video.description %></p>
						<% } %>
					</div>
					<hr>
				</div>

				<% if (typeof user != 'undefined') { %>
					<% if (video.user_id == user.id) { %>
						<% var deletelink = `/v/delete/${video.id}` %>
						<button><a href="<%= deletelink %>">Delete Video</a></button>
					<% } %>
				<% } %>
			</div>


			<div class="reccomendations">
				<% for (var i=0; i < videos.length; i++) { %>
					<div class="links">
						<a href="/v/<%= videos[i].id %>">
							<img src="<%= videos[i].thumbnail %>" width="600px" height="500px">
						</a>
						<a href="/v/<%= videos[i].id %>">
							<h2><strong>&nbsp;&nbsp<%= videos[i].title %></strong></h2>
						</a>
						<p>&nbsp;&nbsp<%= videos[i].description.substr(0, 14) %>...</p>
					</div>
				<% } %>
			</div>
		</div>

		<script type="text/javascript">
			function readMore() {
				var dots = document.getElementById("dots");
				var moreText = document.getElementById("more");
				var btnText = document.getElementById("readMoreBtn");

				if (dots.style.display === "none") {
					dots.style.display = "inline";
					btnText.innerHTML = "Read More";
					moreText.style.display = "none";
				} else {
					dots.style.display = "none";
					btnText.innerHTML = "Read Less";
					moreText.style.display = "inline";
				}
			}
		</script>

		<script type="text/javascript">
			var videovar = <%- JSON.stringify(video) %>;
		</script>

		<script src="/videocontroller.js"></script>
		<script src="/javascript/likedislike.js"></script>
		<script src="/javascript/subscribe.js"></script>
	</body>
</html>
